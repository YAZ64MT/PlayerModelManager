#ifndef __PLAYERMODELMANAGER_H__
#define __PLAYERMODELMANAGER_H__

#include "global.h"

// Parts after LINK_DL_ need to be kept in sync with Link_ShimDisplayList
// MUST BE KEPT IN SYNC WITH ZPlayerModel_DisplayListId IN playermodelmanager_api.h
typedef enum {
    LINK_DL_WAIST,
    LINK_DL_RTHIGH,
    LINK_DL_RSHIN,
    LINK_DL_RFOOT,
    LINK_DL_LTHIGH,
    LINK_DL_LSHIN,
    LINK_DL_LFOOT,
    LINK_DL_HEAD,
    LINK_DL_HAT,
    LINK_DL_COLLAR,
    LINK_DL_LSHOULDER,
    LINK_DL_LFOREARM,
    LINK_DL_LHAND,
    LINK_DL_RSHOULDER,
    LINK_DL_RFOREARM,
    LINK_DL_RHAND,
    LINK_DL_SHEATH_NONE,
    LINK_DL_TORSO,
    LINK_DL_LFIST,
    LINK_DL_LHAND_BOTTLE,
    LINK_DL_LHAND_GUITAR,
    LINK_DL_RFIST,
    LINK_DL_SWORD1_SHEATH,
    LINK_DL_SWORD2_SHEATH,
    LINK_DL_SWORD3_SHEATH,
    LINK_DL_SWORD4_SHEATH,
    LINK_DL_SWORD5_SHEATH,
    LINK_DL_SWORD1_HILT,
    LINK_DL_SWORD2_HILT,
    LINK_DL_SWORD3_HILT,
    LINK_DL_SWORD4_HILT,
    LINK_DL_SWORD5_HILT,
    LINK_DL_SWORD1_BLADE,
    LINK_DL_SWORD2_BLADE,
    LINK_DL_SWORD3_BLADE,
    LINK_DL_SWORD4_BLADE,
    LINK_DL_SWORD4_BLADE_BROKEN,
    LINK_DL_SWORD4_BLADE_FRAGMENT,
    LINK_DL_SWORD5_BLADE,
    LINK_DL_SHIELD1,
    LINK_DL_SHIELD2,
    LINK_DL_SHIELD3,
    LINK_DL_SHIELD3_RAY,
    LINK_DL_BOTTLE_GLASS,
    LINK_DL_BOTTLE_CONTENTS,
    LINK_DL_OCARINA_FAIRY,
    LINK_DL_OCARINA_TIME,
    LINK_DL_DEKU_STICK,
    LINK_DL_BOW,
    LINK_DL_BOW_STRING,
    LINK_DL_BOW_ARROW,
    LINK_DL_SLINGSHOT,
    LINK_DL_SLINGSHOT_STRING,
    LINK_DL_HOOKSHOT,
    LINK_DL_HOOKSHOT_CHAIN,
    LINK_DL_HOOKSHOT_HOOK,
    LINK_DL_HOOKSHOT_RETICLE,
    LINK_DL_FPS_HOOKSHOT,
    LINK_DL_FPS_LFOREARM,
    LINK_DL_FPS_LHAND,
    LINK_DL_FPS_RFOREARM,
    LINK_DL_FPS_RHAND,
    LINK_DL_MASK_SKULL,
    LINK_DL_MASK_SPOOKY,
    LINK_DL_MASK_GERUDO,
    LINK_DL_MASK_TRUTH,
    LINK_DL_MASK_KAFEIS_MASK,
    LINK_DL_MASK_ALL_NIGHT,
    LINK_DL_MASK_BUNNY,
    LINK_DL_MASK_KEATON,
    LINK_DL_MASK_GARO,
    LINK_DL_MASK_ROMANI,
    LINK_DL_MASK_CIRCUS_LEADER,
    LINK_DL_MASK_COUPLE,
    LINK_DL_MASK_POSTMAN,
    LINK_DL_MASK_GREAT_FAIRY,
    LINK_DL_MASK_GIBDO,
    LINK_DL_MASK_DON_GERO,
    LINK_DL_MASK_KAMARO,
    LINK_DL_MASK_CAPTAIN,
    LINK_DL_MASK_STONE,
    LINK_DL_MASK_BREMEN,
    LINK_DL_MASK_BLAST,
    LINK_DL_MASK_SCENTS,
    LINK_DL_MASK_GIANT,
    LINK_DL_MASK_DEKU,
    LINK_DL_MASK_GORON,
    LINK_DL_MASK_ZORA,
    LINK_DL_MASK_FIERCE_DEITY,
    LINK_DL_MASK_DEKU_SCREAM,
    LINK_DL_MASK_GORON_SCREAM,
    LINK_DL_MASK_ZORA_SCREAM,
    LINK_DL_MASK_FIERCE_DEITY_SCREAM,
    LINK_DL_ELEGY_OF_EMPTINESS_STATUE,
    LINK_DL_BOOMERANG,
    LINK_DL_HAMMER,
    LINK_DL_UPGRADE_LFOREARM,
    LINK_DL_UPGRADE_LHAND,
    LINK_DL_UPGRADE_LFIST,
    LINK_DL_UPGRADE_RFOREARM,
    LINK_DL_UPGRADE_RHAND,
    LINK_DL_UPGRADE_RFIST,
    LINK_DL_BOOT_LIRON,
    LINK_DL_BOOT_RIRON,
    LINK_DL_BOOT_LHOVER,
    LINK_DL_BOOT_RHOVER,
    LINK_DL_DEKU_GUARD,
    LINK_DL_PIPE_MOUTH,
    LINK_DL_PIPE_RIGHT,
    LINK_DL_PIPE_UP,
    LINK_DL_PIPE_DOWN,
    LINK_DL_PIPE_LEFT,
    LINK_DL_PIPE_A,
    LINK_DL_STEM_RIGHT,
    LINK_DL_STEM_LEFT,
    LINK_DL_PETAL_PARTICLE,
    LINK_DL_PETAL_PROPELLER_CLOSED,
    LINK_DL_FLOWER_CENTER_CLOSED,
    LINK_DL_FLOWER_PROPELLER_OPEN,
    LINK_DL_FLOWER_CENTER_OPEN,
    LINK_DL_PAD_WOOD,
    LINK_DL_PAD_GRASS,
    LINK_DL_PAD_OPENING,
    LINK_DL_FIRE_PUNCH,
    LINK_DL_DRUM_STRAP,
    LINK_DL_DRUM_UP,
    LINK_DL_DRUM_LEFT,
    LINK_DL_DRUM_RIGHT,
    LINK_DL_DRUM_DOWN,
    LINK_DL_DRUM_A,
    LINK_DL_SHIELD_PRONE,
    LINK_DL_BODY_SHIELD,
    LINK_DL_CURLED,
    LINK_DL_SPIKES,
    LINK_DL_INIT_FIRE,
    LINK_DL_FIRE_ROLL,
    LINK_DL_LFIN,
    LINK_DL_LFIN_SWIM,
    LINK_DL_RFIN,
    LINK_DL_RFIN_SWIM,
    LINK_DL_FIN_SHIELD,
    LINK_DL_MAGIC_BARRIER,
    LINK_DL_GUITAR,
    LINK_DL_PEDESTAL_SWORD,

    // This should be in sync with the end of ZPlayerModelManager_DisplayListId
    // in playermodelmanager_api.h
    //
    // To preserve compatibility between versions, do not change the ordering of DLs before this point.
    LINK_DL_API_END,

    // Keep these shim names in sync with Link_ShimDisplayList
    LINK_DL_SWORD1,
    LINK_DL_SWORD2,
    LINK_DL_SWORD3,
    LINK_DL_SWORD4,
    LINK_DL_SWORD4_BROKEN,
    LINK_DL_SWORD5,
    LINK_DL_SWORD1_HILT_BACK,
    LINK_DL_SWORD2_HILT_BACK,
    LINK_DL_SWORD3_HILT_BACK,
    LINK_DL_SWORD4_HILT_BACK,
    LINK_DL_SWORD5_HILT_BACK,
    LINK_DL_SWORD1_SHEATHED,
    LINK_DL_SWORD2_SHEATHED,
    LINK_DL_SWORD3_SHEATHED,
    LINK_DL_SWORD4_SHEATHED,
    LINK_DL_SWORD5_SHEATHED,
    LINK_DL_SHIELD1_BACK,
    LINK_DL_SHIELD2_BACK,
    LINK_DL_SHIELD3_BACK,
    LINK_DL_SWORD1_SHIELD1_UNSHEATHED,
    LINK_DL_SWORD1_SHIELD2_UNSHEATHED,
    LINK_DL_SWORD1_SHIELD3_UNSHEATHED,
    LINK_DL_SWORD2_SHIELD1_UNSHEATHED,
    LINK_DL_SWORD2_SHIELD2_UNSHEATHED,
    LINK_DL_SWORD2_SHIELD3_UNSHEATHED,
    LINK_DL_SWORD3_SHIELD1_UNSHEATHED,
    LINK_DL_SWORD3_SHIELD2_UNSHEATHED,
    LINK_DL_SWORD3_SHIELD3_UNSHEATHED,
    LINK_DL_SWORD4_SHIELD1_UNSHEATHED,
    LINK_DL_SWORD4_SHIELD2_UNSHEATHED,
    LINK_DL_SWORD4_SHIELD3_UNSHEATHED,
    LINK_DL_SWORD5_SHIELD1_UNSHEATHED,
    LINK_DL_SWORD5_SHIELD2_UNSHEATHED,
    LINK_DL_SWORD5_SHIELD3_UNSHEATHED,
    LINK_DL_SWORD1_SHIELD1_SHEATH,
    LINK_DL_SWORD1_SHIELD2_SHEATH,
    LINK_DL_SWORD1_SHIELD3_SHEATH,
    LINK_DL_SWORD2_SHIELD1_SHEATH,
    LINK_DL_SWORD2_SHIELD2_SHEATH,
    LINK_DL_SWORD2_SHIELD3_SHEATH,
    LINK_DL_SWORD3_SHIELD1_SHEATH,
    LINK_DL_SWORD3_SHIELD2_SHEATH,
    LINK_DL_SWORD3_SHIELD3_SHEATH,
    LINK_DL_SWORD4_SHIELD1_SHEATH,
    LINK_DL_SWORD4_SHIELD2_SHEATH,
    LINK_DL_SWORD4_SHIELD3_SHEATH,
    LINK_DL_SWORD5_SHIELD1_SHEATH,
    LINK_DL_SWORD5_SHIELD2_SHEATH,
    LINK_DL_SWORD5_SHIELD3_SHEATH,
    LINK_DL_SWORD1_SHIELD1_SHEATHED,
    LINK_DL_SWORD1_SHIELD2_SHEATHED,
    LINK_DL_SWORD1_SHIELD3_SHEATHED,
    LINK_DL_SWORD2_SHIELD1_SHEATHED,
    LINK_DL_SWORD2_SHIELD2_SHEATHED,
    LINK_DL_SWORD2_SHIELD3_SHEATHED,
    LINK_DL_SWORD3_SHIELD1_SHEATHED,
    LINK_DL_SWORD3_SHIELD2_SHEATHED,
    LINK_DL_SWORD3_SHIELD3_SHEATHED,
    LINK_DL_SWORD4_SHIELD1_SHEATHED,
    LINK_DL_SWORD4_SHIELD2_SHEATHED,
    LINK_DL_SWORD4_SHIELD3_SHEATHED,
    LINK_DL_SWORD5_SHIELD1_SHEATHED,
    LINK_DL_SWORD5_SHIELD2_SHEATHED,
    LINK_DL_SWORD5_SHIELD3_SHEATHED,
    LINK_DL_LFIST_SWORD1,
    LINK_DL_LFIST_SWORD2,
    LINK_DL_LFIST_SWORD3,
    LINK_DL_LFIST_SWORD4,
    LINK_DL_LFIST_SWORD4_BROKEN,
    LINK_DL_LFIST_SWORD5,
    LINK_DL_RFIST_SHIELD1,
    LINK_DL_RFIST_SHIELD2,
    LINK_DL_RFIST_SHIELD3,
    LINK_DL_SHIELD1_ODD,
    LINK_DL_LFIST_HAMMER,
    LINK_DL_LFIST_BOOMERANG,
    LINK_DL_RFIST_BOW,
    LINK_DL_RFIST_SLINGSHOT,
    LINK_DL_RFIST_HOOKSHOT,
    LINK_DL_RHAND_OCARINA_FAIRY,
    LINK_DL_RHAND_OCARINA_TIME,
    LINK_DL_FPS_RHAND_BOW,
    LINK_DL_FPS_RHAND_SLINGSHOT,
    LINK_DL_FPS_RHAND_HOOKSHOT,
    LINK_DL_GORON_ROLL_1,
    LINK_DL_GORON_ROLL_2,
    LINK_DL_CENTER_FLOWER_PROPELLER_OPEN,
    LINK_DL_CENTER_FLOWER_PROPELLER_CLOSED,
    LINK_DL_MAX
} Link_DisplayList;

// Parts after LINK_SHIMDL_ need to be kept in sync with Link_DisplayList
typedef enum {
    // Hilt + Blade
    LINK_SHIMDL_SWORD1,
    LINK_SHIMDL_SWORD2,
    LINK_SHIMDL_SWORD3,
    LINK_SHIMDL_SWORD4,
    LINK_SHIMDL_SWORD4_BROKEN,
    LINK_SHIMDL_SWORD5,

    // Hilt + Back Matrix
    LINK_SHIMDL_SWORD1_HILT_BACK,
    LINK_SHIMDL_SWORD2_HILT_BACK,
    LINK_SHIMDL_SWORD3_HILT_BACK,
    LINK_SHIMDL_SWORD4_HILT_BACK,
    LINK_SHIMDL_SWORD5_HILT_BACK,

    // Hilt w/ Back Matrix + Sheath
    LINK_SHIMDL_SWORD1_SHEATHED,
    LINK_SHIMDL_SWORD2_SHEATHED,
    LINK_SHIMDL_SWORD3_SHEATHED,
    LINK_SHIMDL_SWORD4_SHEATHED,
    LINK_SHIMDL_SWORD5_SHEATHED,

    // Shield w/ Back Matrix
    LINK_SHIMDL_SHIELD1_BACK,
    LINK_SHIMDL_SHIELD2_BACK,
    LINK_SHIMDL_SHIELD3_BACK,

    // Sheath DL for each respective sword + shield combo
    // Name is subject to change
    LINK_SHIMDL_SWORD1_SHIELD1_UNSHEATHED,
    LINK_SHIMDL_SWORD1_SHIELD2_UNSHEATHED,
    LINK_SHIMDL_SWORD1_SHIELD3_UNSHEATHED,
    LINK_SHIMDL_SWORD2_SHIELD1_UNSHEATHED,
    LINK_SHIMDL_SWORD2_SHIELD2_UNSHEATHED,
    LINK_SHIMDL_SWORD2_SHIELD3_UNSHEATHED,
    LINK_SHIMDL_SWORD3_SHIELD1_UNSHEATHED,
    LINK_SHIMDL_SWORD3_SHIELD2_UNSHEATHED,
    LINK_SHIMDL_SWORD3_SHIELD3_UNSHEATHED,
    LINK_SHIMDL_SWORD4_SHIELD1_UNSHEATHED,
    LINK_SHIMDL_SWORD4_SHIELD2_UNSHEATHED,
    LINK_SHIMDL_SWORD4_SHIELD3_UNSHEATHED,
    LINK_SHIMDL_SWORD5_SHIELD1_UNSHEATHED,
    LINK_SHIMDL_SWORD5_SHIELD2_UNSHEATHED,
    LINK_SHIMDL_SWORD5_SHIELD3_UNSHEATHED,

    // Sheath + Shield w/ Back Matrix
    LINK_SHIMDL_SWORD1_SHIELD1_SHEATH,
    LINK_SHIMDL_SWORD1_SHIELD2_SHEATH,
    LINK_SHIMDL_SWORD1_SHIELD3_SHEATH,
    LINK_SHIMDL_SWORD2_SHIELD1_SHEATH,
    LINK_SHIMDL_SWORD2_SHIELD2_SHEATH,
    LINK_SHIMDL_SWORD2_SHIELD3_SHEATH,
    LINK_SHIMDL_SWORD3_SHIELD1_SHEATH,
    LINK_SHIMDL_SWORD3_SHIELD2_SHEATH,
    LINK_SHIMDL_SWORD3_SHIELD3_SHEATH,
    LINK_SHIMDL_SWORD4_SHIELD1_SHEATH,
    LINK_SHIMDL_SWORD4_SHIELD2_SHEATH,
    LINK_SHIMDL_SWORD4_SHIELD3_SHEATH,
    LINK_SHIMDL_SWORD5_SHIELD1_SHEATH,
    LINK_SHIMDL_SWORD5_SHIELD2_SHEATH,
    LINK_SHIMDL_SWORD5_SHIELD3_SHEATH,

    // Sheath + Shield w/ Back Matrix + Hilt w/ Back Matrix
    LINK_SHIMDL_SWORD1_SHIELD1_SHEATHED,
    LINK_SHIMDL_SWORD1_SHIELD2_SHEATHED,
    LINK_SHIMDL_SWORD1_SHIELD3_SHEATHED,
    LINK_SHIMDL_SWORD2_SHIELD1_SHEATHED,
    LINK_SHIMDL_SWORD2_SHIELD2_SHEATHED,
    LINK_SHIMDL_SWORD2_SHIELD3_SHEATHED,
    LINK_SHIMDL_SWORD3_SHIELD1_SHEATHED,
    LINK_SHIMDL_SWORD3_SHIELD2_SHEATHED,
    LINK_SHIMDL_SWORD3_SHIELD3_SHEATHED,
    LINK_SHIMDL_SWORD4_SHIELD1_SHEATHED,
    LINK_SHIMDL_SWORD4_SHIELD2_SHEATHED,
    LINK_SHIMDL_SWORD4_SHIELD3_SHEATHED,
    LINK_SHIMDL_SWORD5_SHIELD1_SHEATHED,
    LINK_SHIMDL_SWORD5_SHIELD2_SHEATHED,
    LINK_SHIMDL_SWORD5_SHIELD3_SHEATHED,

    // Left Fist + Sword w/ Blade
    LINK_SHIMDL_LFIST_SWORD1,
    LINK_SHIMDL_LFIST_SWORD2,
    LINK_SHIMDL_LFIST_SWORD3,
    LINK_SHIMDL_LFIST_SWORD4,
    LINK_SHIMDL_LFIST_SWORD4_BROKEN,
    LINK_SHIMDL_LFIST_SWORD5,

    // Right Fist + Shield
    LINK_SHIMDL_RFIST_SHIELD1,
    LINK_SHIMDL_RFIST_SHIELD2,
    LINK_SHIMDL_RFIST_SHIELD3,

    // Hands + Items
    LINK_SHIMDL_LFIST_HAMMER,
    LINK_SHIMDL_LFIST_BOOMERANG,
    LINK_SHIMDL_RFIST_BOW,
    LINK_SHIMDL_RFIST_SLINGSHOT,
    LINK_SHIMDL_RFIST_HOOKSHOT,
    LINK_SHIMDL_RHAND_OCARINA_FAIRY,
    LINK_SHIMDL_RHAND_OCARINA_TIME,
    LINK_SHIMDL_LHAND_GUITAR,

    // First Person Items
    LINK_SHIMDL_FPS_RHAND_BOW,
    LINK_SHIMDL_FPS_RHAND_SLINGSHOT,
    LINK_SHIMDL_FPS_RHAND_HOOKSHOT,

    // Reserved (OoT)
    LINK_SHIMDL_SHIELD1_ODD,

    // # of shim DLs
    LINK_SHIMDL_MAX,
} Link_ShimDisplayList;

// Parts after LINK_EQUI{_ need to be kept in sync with Link_ShimDisplayList
// MUST BE KEPT IN SYNC WITH ZPlayerModel_MatrixId IN playermodelmanager_api.h
typedef enum {
    LINK_EQUIP_MATRIX_SWORD1_BACK,
    LINK_EQUIP_MATRIX_SWORD2_BACK,
    LINK_EQUIP_MATRIX_SWORD3_BACK,
    LINK_EQUIP_MATRIX_SWORD4_BACK,
    LINK_EQUIP_MATRIX_SWORD5_BACK,
    LINK_EQUIP_MATRIX_SHIELD1_BACK,
    LINK_EQUIP_MATRIX_SHIELD2_BACK,
    LINK_EQUIP_MATRIX_SHIELD3_BACK,
    LINK_EQUIP_MATRIX_SHIELD1_ODD,
    LINK_EQUIP_MATRIX_MAX,
} Link_EquipmentMatrix;

#define PLAYER_LIMB_COUNT 21

typedef struct {
    u64 flags;
    Gfx *models[LINK_DL_MAX];
    Mtx *equipMtx[LINK_EQUIP_MATRIX_MAX];
    TexturePtr eyesTextures[PLAYER_EYES_MAX];
    TexturePtr mouthTextures[PLAYER_MOUTH_MAX];
    FlexSkeletonHeader *skeleton;
} Link_ModelInfo;

typedef struct {
    FlexSkeletonHeader flexSkeleton;
    LodLimb *limbPtrs[PLAYER_LIMB_COUNT];
    LodLimb limbs[PLAYER_LIMB_COUNT];
} Link_SkeletonProxy;

typedef struct {
    PlayerTransformation form;
    Link_ModelInfo current;
    Link_ModelInfo vanilla;
    Link_SkeletonProxy skeleton;
    Gfx *shimDisplayListPtrs[LINK_SHIMDL_MAX];
    Gfx *mtxDisplayLists[LINK_EQUIP_MATRIX_MAX];
    Gfx displayLists[LINK_DL_MAX];
} Link_FormProxy;

#endif